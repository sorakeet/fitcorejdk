/**
 * Copyright (c) 1997, 2013, Oracle and/or its affiliates. All rights reserved.
 * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
 */
package javax.swing;

import java.awt.*;
import java.io.FilterInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InterruptedIOException;

public class ProgressMonitorInputStream extends FilterInputStream{
    private ProgressMonitor monitor;
    private int nread=0;
    private int size=0;

    public ProgressMonitorInputStream(Component parentComponent,
                                      Object message,
                                      InputStream in){
        super(in);
        try{
            size=in.available();
        }catch(IOException ioe){
            size=0;
        }
        monitor=new ProgressMonitor(parentComponent,message,null,0,size);
    }

    public ProgressMonitor getProgressMonitor(){
        return monitor;
    }

    public int read() throws IOException{
        int c=in.read();
        if(c>=0) monitor.setProgress(++nread);
        if(monitor.isCanceled()){
            InterruptedIOException exc=
                    new InterruptedIOException("progress");
            exc.bytesTransferred=nread;
            throw exc;
        }
        return c;
    }

    public int read(byte b[]) throws IOException{
        int nr=in.read(b);
        if(nr>0) monitor.setProgress(nread+=nr);
        if(monitor.isCanceled()){
            InterruptedIOException exc=
                    new InterruptedIOException("progress");
            exc.bytesTransferred=nread;
            throw exc;
        }
        return nr;
    }

    public int read(byte b[],
                    int off,
                    int len) throws IOException{
        int nr=in.read(b,off,len);
        if(nr>0) monitor.setProgress(nread+=nr);
        if(monitor.isCanceled()){
            InterruptedIOException exc=
                    new InterruptedIOException("progress");
            exc.bytesTransferred=nread;
            throw exc;
        }
        return nr;
    }

    public long skip(long n) throws IOException{
        long nr=in.skip(n);
        if(nr>0) monitor.setProgress(nread+=nr);
        return nr;
    }

    public void close() throws IOException{
        in.close();
        monitor.close();
    }

    public synchronized void reset() throws IOException{
        in.reset();
        nread=size-in.available();
        monitor.setProgress(nread);
    }
}
